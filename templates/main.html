{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Men√∫ Semanal</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css">
</head>
<body>
  <nav class="navbar navbar-expand-lg bg-danger  navbar-danger ">
    <div class="container">
      <a class="navbar-brand" href="#"><img src="/myapp/static/img/logo.flg.png" alt="el logo"></a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <a class="nav-link active" aria-current="page" href="/">Inicio</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">Nosotros</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{% url 'logout' %}">Salir</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="container">
    <h1 class="mb-4 text-primary">Selecciona un d√≠a de la semana</h1>
  
    <form method="get" action="{% url 'main' %}" class="mb-5">
      <div class="mb-3">
        <label for="dia" class="form-label">D√≠a:</label>
        <select name="dia" id="dia" class="form-select w-auto d-inline-block" onchange="this.form.submit()">
          {% for codigo, nombre in dias_semana.items %}
            <option value="{{ codigo }}" {% if dia_actual == codigo %}selected{% endif %}>
              {{ nombre }}
            </option>
          {% endfor %}
        </select>
      </div>
    </form>
  
    <h2 class="mb-4 text-success">Platos disponibles el {{ dia_actual_nombre }}</h2>
    {% if disponibles %}
      <div class="row row-cols-1 row-cols-md-2 g-4 mb-5">
        {% for disp in disponibles %}
          <div class="col">
            <div class="card h-100 shadow-sm">
              {% if disp.plato.imagen %}
                <img src="{{ disp.plato.imagen.url }}" class="card-img-top" alt="{{ disp.plato.nombre }}">
              {% endif %}
              <div class="card-body">
                <h3 class="card-title">{{ disp.plato.nombre }}</h3>
                <p class="card-text">{{ disp.plato.descripcion }}</p>
                <p class="card-text fw-bold text-primary">Precio: ${{ disp.plato.precio }}</p>
  
                <form method="post" action="">
                  {% csrf_token %}
                  <input type="hidden" name="plato_id" value="{{ disp.plato.id }}">
                  <input type="hidden" name="dia_semana" value="{{ dia_actual }}">
                  <div class="mb-3">
                    <label class="form-label">Cantidad:</label>
                    <input type="number" name="cantidad" value="1" min="1" class="form-control w-25 d-inline-block">
                  </div>
                  <button type="submit" class="btn btn-outline-primary">Agregar al carrito</button>
                </form>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p class="text-muted">No hay platos disponibles para este d√≠a.</p>
    {% endif %}
  
    <hr>
  
    <h2 class="mb-4 text-warning">Tu carrito üõí</h2>
    {% if carrito_items %}
      <ul class="list-group mb-3">
        {% for item in carrito_items %}
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <div>
              {{ item.cantidad }}√ó {{ item.plato.nombre }} ({{ item.get_dia_semana_display }})
              <br>
              <small class="text-muted">Subtotal: ${{ item.subtotal }}</small>
            </div>
            <form action="{% url 'eliminar_item' item.id %}" method="post" class="ms-3">
              {% csrf_token %}
              <button type="submit" class="btn btn-danger btn-sm">Eliminar</button>
            </form>
          </li>
        {% endfor %}
      </ul>
      <p class="fs-5"><strong>Total: ${{ total_carrito }}</strong></p>
    {% else %}
      <p class="text-muted">Tu carrito est√° vac√≠o.</p>
    {% endif %}
  
    {% if carrito_items %}
      <form action="{% url 'pago' %}" method="get">
        <button type="submit" class="btn btn-success">Pagar</button>
      </form>
    {% endif %}
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
